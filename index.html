<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Test Plan Architect | Professional</title>
    <style>
        :root {
            --primary: #ff6d5a;
            --primary-hover: #e55b4a;
            --bg: #f0f2f5;
            --surface: #ffffff;
            --text: #1a1a1b;
            --text-sub: #64748b;
            --border: #e2e8f0;
            --code-bg: #0f172a;
            --code-text: #38bdf8;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg: #0f172a;
            --surface: #1e293b;
            --text: #f8fafc;
            --text-sub: #94a3b8;
            --border: #334155;
            --code-bg: #000000;
            --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }

        body { font-family: 'Inter', system-ui, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 40px 20px; transition: all 0.3s ease; }
        .container { max-width: 1000px; margin: auto; background: var(--surface); padding: 40px; border-radius: 20px; box-shadow: var(--shadow); border: 1px solid var(--border); }

        /* Header Section */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .header h1 { font-size: 24px; font-weight: 800; margin: 0; background: linear-gradient(90deg, var(--primary), #f59e0b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Toggle & Button Styles */
        .theme-toggle { background: var(--border); border: none; padding: 8px 16px; border-radius: 99px; cursor: pointer; color: var(--text); font-weight: 600; font-size: 13px; display: flex; align-items: center; gap: 8px; }

        .input-card { background: var(--bg); padding: 20px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 25px; }
        .label-text { font-weight: 700; font-size: 14px; margin-bottom: 12px; display: block; color: var(--text-sub); text-transform: uppercase; letter-spacing: 0.5px; }

        textarea { 
            width: 100%; height: 180px; border: 1px solid var(--border); border-radius: 10px; padding: 15px; 
            font-family: 'Fira Code', monospace; font-size: 14px; background: var(--surface); color: var(--text);
            box-sizing: border-box; resize: vertical; transition: border-color 0.2s;
        }
        textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(255, 109, 90, 0.1); }

        /* Action Row */
        .actions { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 15px; }
        .upload-area { position: relative; overflow: hidden; }
        .upload-btn { background: transparent; border: 2px dashed var(--text-sub); color: var(--text-sub); padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s; }
        .upload-btn:hover { border-color: var(--primary); color: var(--primary); }
        
        .main-btn { background: var(--primary); color: white; border: none; padding: 12px 30px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 16px; transition: all 0.2s; box-shadow: 0 4px 12px rgba(255, 109, 90, 0.3); }
        .main-btn:hover { background: var(--primary-hover); transform: translateY(-2px); }
        .main-btn:disabled { background: var(--text-sub); opacity: 0.7; transform: none; }

        /* Result Section */
        .result-box { margin-top: 35px; border-radius: 12px; overflow: hidden; position: relative; border: 1px solid var(--border); }
        .result-header { background: var(--border); padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; }
        .result-header span { font-weight: 700; font-size: 13px; color: var(--text-sub); }

        #result { 
            background: var(--code-bg); color: var(--code-text); padding: 25px; margin: 0; font-family: 'Fira Code', monospace;
            font-size: 14px; line-height: 1.6; min-height: 150px; overflow-x: auto; white-space: pre-wrap;
        }

        /* Status & Loaders */
        .loader-spinner { width: 18px; height: 18px; border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #fff; animation: spin 0.8s linear infinite; display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .status-msg { font-size: 14px; font-weight: 600; display: none; margin-left: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>AI Test Architect</h1>
            <button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">üåô Dark Mode</button>
        </div>

        <div class="input-card">
            <div class="actions">
                <span class="label-text">Input Requirements</span>
                <div class="upload-area">
                    <label class="upload-btn" for="fileInput">üìÅ Upload JSON</label>
                    <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="handleFileUpload(event)">
                </div>
            </div>
            
            <textarea id="jsonInput" placeholder="Paste your requirement JSON here...">{
  "requirement_id": "REQ-CART-002",
  "module": "Shopping Cart",
  "complexity": "Medium",
  "features": [
    "Add item to cart",
    "Remove item from cart",
    "Update item quantity",
    "Apply discount coupon"
  ]
}</textarea>
        </div>

        <div style="display: flex; align-items: center;">
            <button id="genBtn" class="main-btn" onclick="triggerWorkflow()">
                <span id="btnText">Generate Test Plan</span>
                <div id="loader" class="loader-spinner"></div>
            </button>
            <span id="status" class="status-msg"></span>
        </div>

        <div class="result-box">
            <div class="result-header">
                <span>OUTPUT_TERMINAL.v1</span>
                <button style="background: none; border: none; color: var(--primary); cursor: pointer; font-weight: 700; font-size: 12px;" onclick="copyResult()">COPY JSON</button>
            </div>
            <pre id="result">Waiting for input data...</pre>
        </div>
    </div>

    <script>
        // --- Dark Mode Engine ---
        function toggleTheme() {
            const body = document.documentElement;
            const btn = document.getElementById('themeBtn');
            const isDark = body.getAttribute('data-theme') === 'dark';
            
            body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            btn.innerHTML = isDark ? 'üåô Dark Mode' : '‚òÄÔ∏è Light Mode';
            localStorage.setItem('theme', isDark ? 'light' : 'dark');
        }

        // Auto-load theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        document.getElementById('themeBtn').innerHTML = savedTheme === 'dark' ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';

        // --- File System ---
        function handleFileUpload(event) {
            const file = event.target.files[0];
            const status = document.getElementById('status');
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const json = JSON.parse(e.target.result);
                    document.getElementById('jsonInput').value = JSON.stringify(json, null, 2);
                    status.innerText = "‚úì " + file.name + " loaded";
                    status.style.display = "inline";
                    status.style.color = "#10b981";
                } catch (err) { alert("Invalid JSON file!"); }
            };
            reader.readAsText(file);
        }

        // --- n8n Webhook Engine ---
        async function triggerWorkflow() {
            const resultArea = document.getElementById('result');
            const btn = document.getElementById('genBtn');
            const btnText = document.getElementById('btnText');
            const loader = document.getElementById('loader');
            const status = document.getElementById('status');
            const inputData = document.getElementById('jsonInput').value;

            // UI Loading State
            btn.disabled = true;
            btnText.style.display = "none";
            loader.style.display = "inline-block";
            status.style.display = "inline";
            status.innerText = "Architecting Plan...";
            status.style.color = "var(--primary)";
            resultArea.style.opacity = "0.4";

            try {
                const response = await fetch('https://sudipta-abc.app.n8n.cloud/webhook/generate-test-plan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: inputData
                });

                if (!response.ok) throw new Error("n8n Connection Failed");

                const data = await response.json();
                const plan = Array.isArray(data) ? data[0] : (data.body || data);

                resultArea.innerText = JSON.stringify(plan, null, 2);
                resultArea.style.opacity = "1";
                status.innerText = "‚úì Generation Complete";
                status.style.color = "#10b981";
            } catch (error) {
                resultArea.innerText = "CRITICAL_ERROR: " + error.message;
                status.innerText = "‚úï Failed";
                status.style.color = "#ef4444";
            } finally {
                btn.disabled = false;
                btnText.style.display = "inline";
                loader.style.display = "none";
            }
        }

        function copyResult() {
            navigator.clipboard.writeText(document.getElementById('result').innerText);
            alert("Test Plan JSON copied to clipboard!");
        }
    </script>
</body>
</html>